(function(o,c){typeof exports=="object"&&typeof module<"u"?c(require("@fiftyone/plugins"),require("@fiftyone/operators"),require("@fiftyone/state"),require("recoil"),require("react")):typeof define=="function"&&define.amd?define(["@fiftyone/plugins","@fiftyone/operators","@fiftyone/state","recoil","react"],c):(o=typeof globalThis<"u"?globalThis:o||self,c(o.__fop__,o.__foo__,o.__fos__,o.recoil,o.React))})(this,function(o,c,h,b,s){"use strict";function R(n){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const a in n)if(a!=="default"){const i=Object.getOwnPropertyDescriptor(n,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:()=>n[a]})}}return t.default=n,Object.freeze(t)}const k=R(h);function C(){const n=b.useRecoilValue(k.modalSample),[t,a]=s.useState([]),[i,S]=s.useState("user_clicks"),[d,_]=s.useState("segment-anything-2-hiera-small-image-torch"),[u,v]=s.useState("label"),m=s.useRef(null),f=s.useRef(null),z=e=>{if(!m.current||!f.current)return;const l=m.current,r=f.current,p=l.getBoundingClientRect(),x=r.getBoundingClientRect(),O=e.clientX-x.left,X=e.clientY-x.top,Y=e.clientX-p.left,j=e.clientY-p.top,D=p.width,P=p.height,q=Y/D,T=j/P,y={displayX:O,displayY:X,normalizedX:parseFloat(q.toFixed(4)),normalizedY:parseFloat(T.toFixed(4))};console.log("Click captured:",y),a(W=>[...W,y])},w=async()=>{if(t.length===0){alert("No clicks to save");return}if(!n){alert("No sample selected");return}if(!i.trim()){alert("Please enter a field name");return}const e=n.sample._id,l=t.map(r=>[r.normalizedX,r.normalizedY]);try{await c.executeOperator("@51labs/click-segmentation/save_keypoints",{sample_id:e,keypoints:l,field_name:i.trim(),label_name:u.trim()}),a([])}catch(r){console.error("Error saving keypoints:",r),alert(`Failed: ${r.message}`)}},F=async()=>{if(!n){alert("No sample selected");return}if(!d.trim()){alert("Please enter a model name");return}const e=n.sample._id;try{alert("Segmentation started ..."),await c.executeOperator("@51labs/click-segmentation/segment_with_keypoints",{sample_id:e,keypoints_field:i.trim(),model_name:d.trim()})}catch(l){console.error("Error saving keypoints:",l),alert(`Failed: ${l.message}`)}},N=()=>{a([])},g=n.sample,B=g==null?void 0:g.filepath,I=`/media?filepath=${encodeURIComponent(B)}`;return React.createElement("div",{style:{padding:"20px",display:"flex",flexDirection:"column",height:"100%"}},React.createElement("div",{style:{marginBottom:"10px"}},React.createElement("h3",{style:{margin:0}},"Image segmentation via point prompts"),React.createElement("p",{style:{fontSize:"12px",color:"#666",margin:"5px 0"}},"Click on the image to capture coordinates")),React.createElement("div",{ref:f,style:{width:"auto",height:"800px",position:"relative",backgroundColor:"#1e1e1e",borderRadius:"4px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px"},onClick:z},React.createElement("img",{ref:m,src:I,alt:"Sample",style:{maxWidth:"200%",maxHeight:"auto",objectFit:"contain",cursor:"crosshair",userSelect:"none"},onLoad:()=>console.log("Image loaded successfully"),onError:e=>console.error("Image failed to load",e)}),t.map((e,l)=>React.createElement("div",{key:e.id,style:{position:"absolute",left:`${e.displayX}px`,top:`${e.displayY}px`,width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ff4444",border:"2px solid white",transform:"translate(-50%, -50%)",pointerEvents:"none",boxShadow:"0 0 4px rgba(0,0,0,0.5)",zIndex:10}}))),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Sample field name for saving clicks (as keypoints)"),React.createElement("input",{type:"text",value:i,onChange:e=>S(e.target.value),placeholder:"e.g., user_clicks, keypoints",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Label name for the current set of clicks"),React.createElement("input",{type:"text",value:u,onChange:e=>v(e.target.value),placeholder:"e.g., animal, person",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:w,disabled:t.length===0,style:{padding:"8px 16px",backgroundColor:t.length>0?"#2196F3":"#ccc",color:"white",border:"none",borderRadius:"4px",cursor:t.length>0?"pointer":"not-allowed",fontWeight:"bold"}},"Save as Keypoints (",t.length,")"),React.createElement("button",{onClick:N,style:{padding:"8px 16px",backgroundColor:"#ff5555",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Clear Clicks (",t.length,")")),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Promptable segmentation model from FiftyOne model zoo"),React.createElement("input",{type:"text",value:d,onChange:e=>_(e.target.value),placeholder:"e.g., segment-anything-2-hiera-small-image-torch",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:F,disabled:t.length>0,style:{padding:"8px 16px",backgroundColor:t.length>0?"#ccc":"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:t.length==0?"pointer":"not-allowed",fontWeight:"bold"}},"Segment with keypoints")))}o.registerComponent({name:"ClickSegmentation",label:"Click To Segment",component:C,type:o.PluginComponentType.Panel,activator:E,panelOptions:{surfaces:"modal"}});function E({dataset:n}){return!0}});
//# sourceMappingURL=index.umd.js.map
