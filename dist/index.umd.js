(function(n,s){typeof exports=="object"&&typeof module<"u"?s(require("@fiftyone/plugins"),require("@fiftyone/operators"),require("@fiftyone/state"),require("recoil"),require("react")):typeof define=="function"&&define.amd?define(["@fiftyone/plugins","@fiftyone/operators","@fiftyone/state","recoil","react"],s):(n=typeof globalThis<"u"?globalThis:n||self,s(n.__fop__,n.__foo__,n.__fos__,n.recoil,n.React))})(this,function(n,s,x,h,c){"use strict";function b(o){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const a in o)if(a!=="default"){const i=Object.getOwnPropertyDescriptor(o,a);Object.defineProperty(t,a,i.get?i:{enumerable:!0,get:()=>o[a]})}}return t.default=o,Object.freeze(t)}const R=b(x);function k(){const o=h.useRecoilValue(R.modalSample),[t,a]=c.useState([]),[i,_]=c.useState("user_clicks"),[d,E]=c.useState("segment-anything-2-hiera-small-image-torch"),m=c.useRef(null),f=c.useRef(null),S=e=>{if(!m.current||!f.current)return;const l=m.current,r=f.current,p=l.getBoundingClientRect(),u=r.getBoundingClientRect(),O=e.clientX-u.left,B=e.clientY-u.top,N=e.clientX-p.left,X=e.clientY-p.top,Y=p.width,j=p.height,P=N/Y,D=X/j,y={displayX:O,displayY:B,normalizedX:parseFloat(P.toFixed(4)),normalizedY:parseFloat(D.toFixed(4))};console.log("Click captured:",y),a(q=>[...q,y])},v=async()=>{if(t.length===0){alert("No clicks to save");return}if(!o){alert("No sample selected");return}if(!i.trim()){alert("Please enter a field name");return}const e=o.sample._id,l=t.map(r=>[r.normalizedX,r.normalizedY]);try{await s.executeOperator("@51labs/click-segmentation/save_keypoints",{sample_id:e,keypoints:l,field_name:i.trim()}),a([])}catch(r){console.error("Error saving keypoints:",r),alert(`Failed: ${r.message}`)}},w=async()=>{if(!o){alert("No sample selected");return}if(!d.trim()){alert("Please enter a model name");return}const e=o.sample._id;try{alert("Segmentation started ..."),await s.executeOperator("@51labs/click-segmentation/segment_with_keypoints",{sample_id:e,keypoints_field:i.trim(),model_name:d.trim()})}catch(l){console.error("Error saving keypoints:",l),alert(`Failed: ${l.message}`)}},z=()=>{a([])},g=o.sample,F=g==null?void 0:g.filepath,I=`/media?filepath=${encodeURIComponent(F)}`;return React.createElement("div",{style:{padding:"20px",display:"flex",flexDirection:"column",height:"100%"}},React.createElement("div",{style:{marginBottom:"10px"}},React.createElement("h3",{style:{margin:0}},"Image segmentation via point prompts"),React.createElement("p",{style:{fontSize:"12px",color:"#666",margin:"5px 0"}},"Click on the image to capture coordinates")),React.createElement("div",{ref:f,style:{width:"100%",height:"800px",position:"relative",backgroundColor:"#1e1e1e",borderRadius:"4px",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"20px"},onClick:S},React.createElement("img",{ref:m,src:I,alt:"Sample",style:{maxWidth:"200%",maxHeight:"auto",objectFit:"contain",cursor:"crosshair",userSelect:"none"},onLoad:()=>console.log("Image loaded successfully"),onError:e=>console.error("Image failed to load",e)}),t.map((e,l)=>React.createElement("div",{key:e.id,style:{position:"absolute",left:`${e.displayX}px`,top:`${e.displayY}px`,width:"8px",height:"8px",borderRadius:"50%",backgroundColor:"#ff4444",border:"2px solid white",transform:"translate(-50%, -50%)",pointerEvents:"none",boxShadow:"0 0 4px rgba(0,0,0,0.5)",zIndex:10}}))),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Sample field name for saving clicks (as keypoints)"),React.createElement("input",{type:"text",value:i,onChange:e=>_(e.target.value),placeholder:"e.g., user_clicks, keypoints",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:v,disabled:t.length===0,style:{padding:"8px 16px",backgroundColor:t.length>0?"#2196F3":"#ccc",color:"white",border:"none",borderRadius:"4px",cursor:t.length>0?"pointer":"not-allowed",fontWeight:"bold"}},"Save as Keypoints (",t.length,")"),React.createElement("button",{onClick:z,style:{padding:"8px 16px",backgroundColor:"#ff5555",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"}},"Clear Clicks (",t.length,")")),React.createElement("div",{style:{marginBottom:"8px",padding:"4px"}},React.createElement("label",{style:{display:"flex",flexDirection:"column",gap:"8px",fontSize:"14px"}},React.createElement("span",{style:{fontSize:"14px",color:"#666"}},"Promptable segmentation model from FiftyOne model zoo"),React.createElement("input",{type:"text",value:d,onChange:e=>E(e.target.value),placeholder:"e.g., segment-anything-2-hiera-small-image-torch",style:{padding:"8px 12px",border:"1px solid #ccc",borderRadius:"4px",fontSize:"14px",fontFamily:"monospace"}}))),React.createElement("div",{style:{marginBottom:"10px",display:"flex",gap:"10px"}},React.createElement("button",{onClick:w,disabled:t.length>0,style:{padding:"8px 16px",backgroundColor:t.length>0?"#ccc":"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:t.length==0?"pointer":"not-allowed",fontWeight:"bold"}},"Segment with keypoints")))}n.registerComponent({name:"ClickSegmentation",label:"Click To Segment",component:k,type:n.PluginComponentType.Panel,activator:C,panelOptions:{surfaces:"modal"}});function C({dataset:o}){return!0}});
//# sourceMappingURL=index.umd.js.map
