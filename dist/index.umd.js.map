{"version":3,"file":"index.umd.js","sources":["../src/ClickSegmentation.tsx","../src/ClickSegmentationPlugin.tsx"],"sourcesContent":["import {\n  executeOperator,\n  Operator,\n  OperatorConfig,\n  registerOperator,\n} from \"@fiftyone/operators\";\nimport * as fos from \"@fiftyone/state\";\nimport _ from \"lodash\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport { useState, useRef, useCallback } from \"react\";\n\nexport function ClickSegmentation() {\n  const modalSample = useRecoilValue(fos.modalSample);\n  const [clicks, setClicks] = useState([]);\n  const [fieldName, setFieldName] = useState(\"user_clicks\");\n  const [modelName, setModelName] = useState(\"segment-anything-2-hiera-small-image-torch\");\n  const [labelName, setLabelName] = useState(\"label\");\n  const imageRef = useRef(null);\n  const containerRef = useRef(null);\n\n  const handleImageClick = (event) => {\n    if (!imageRef.current || !containerRef.current) return;\n    \n    const img = imageRef.current;\n    const container = containerRef.current;\n    const imgRect = img.getBoundingClientRect();\n    const containerRect = container.getBoundingClientRect();\n    \n    const x = event.clientX - containerRect.left;\n    const y = event.clientY - containerRect.top;\n    const imgX = event.clientX - imgRect.left;\n    const imgY = event.clientY - imgRect.top;\n    \n    const displayWidth = imgRect.width;\n    const displayHeight = imgRect.height;\n    const normalizedX = imgX / displayWidth;\n    const normalizedY = imgY / displayHeight;\n  \n    const clickData = {\n      displayX: x,\n      displayY: y,\n      normalizedX: parseFloat(normalizedX.toFixed(4)),\n      normalizedY: parseFloat(normalizedY.toFixed(4)),\n    };\n    \n    console.log(\"Click captured:\", clickData);\n    setClicks((prev) => [...prev, clickData]);\n  };\n  \n  const saveAsKeypoints = async () => {\n    if (clicks.length === 0) {\n      alert(\"No clicks to save\");\n      return;\n    }\n    \n    if (!modalSample) {\n      alert(\"No sample selected\");\n      return;\n    }\n    \n    if (!fieldName.trim()) {\n      alert(\"Please enter a field name\");\n      return;\n    }\n\n    const sampleId = modalSample.sample._id;\n    const keypointCoords = clicks.map(click => [\n      click.normalizedX,\n      click.normalizedY,\n    ]);\n    \n    try {\n      await executeOperator(\n        \"@51labs/click-segmentation/save_keypoints\",\n        {\n          sample_id: sampleId,\n          keypoints: keypointCoords,\n          field_name: fieldName.trim(),\n          label_name: labelName.trim()\n        }\n      );\n      setClicks([]);\n    } catch (error) {\n      console.error(\"Error saving keypoints:\", error);\n      alert(`Failed: ${error.message}`);\n    }\n  };\n\n  const segmentWithKeypoints = async () => {\n    if (!modalSample) {\n      alert(\"No sample selected\");\n      return;\n    }\n    \n    if (!modelName.trim()) {\n      alert(\"Please enter a model name\");\n      return;\n    }\n\n    const sampleId = modalSample.sample._id;    \n    try {\n      alert(\"Segmentation started ...\");\n      await executeOperator(\n        \"@51labs/click-segmentation/segment_with_keypoints\",\n        {\n          sample_id: sampleId,\n          keypoints_field: fieldName.trim(),\n          model_name: modelName.trim()\n        }\n      );\n    } catch (error) {\n      console.error(\"Error saving keypoints:\", error);\n      alert(`Failed: ${error.message}`);\n    }\n  };\n\n  const clearClicks = () => {\n    setClicks([]);\n  };\n  \n  const sample = modalSample.sample;\n  const filepath = sample?.filepath;\n  const mediaUrl = `/media?filepath=${encodeURIComponent(filepath)}`;\n  \n  return (\n    <div style={{ padding: \"20px\", display: \"flex\", flexDirection: \"column\", height: \"100%\" }}>\n      <div style={{ marginBottom: \"10px\" }}>\n        <h3 style={{ margin: 0 }}>Image segmentation via point prompts</h3>\n        <p style={{ fontSize: \"12px\", color: \"#666\", margin: \"5px 0\" }}>\n          Click on the image to capture coordinates\n        </p>\n      </div>\n      \n      {/* Image Viewer with Click Markers */}\n      <div \n        ref={containerRef}\n        style={{ \n          width: \"auto\", \n          height: \"800px\",\n          position: \"relative\",\n          backgroundColor: \"#1e1e1e\",\n          borderRadius: \"4px\",\n          overflow: \"hidden\",\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          marginBottom: \"20px\"\n        }}\n        onClick={handleImageClick}\n      >\n        <img \n          ref={imageRef}\n          src={mediaUrl}\n          alt=\"Sample\"\n          style={{ \n            maxWidth: \"200%\",\n            maxHeight: \"auto\",\n            objectFit: \"contain\",\n            cursor: \"crosshair\",\n            userSelect: \"none\"\n          }}\n          onLoad={() => console.log(\"Image loaded successfully\")}\n          onError={(e) => console.error(\"Image failed to load\", e)}\n        />\n        \n        {/* Render clicks as dots on the image */}\n        {clicks.map((click, index) => (\n          <div\n            key={click.id}\n            style={{\n              position: \"absolute\",\n              left: `${click.displayX}px`,\n              top: `${click.displayY}px`,\n              width: \"8px\",\n              height: \"8px\",\n              borderRadius: \"50%\",\n              backgroundColor: \"#ff4444\",\n              border: \"2px solid white\",\n              transform: \"translate(-50%, -50%)\",\n              pointerEvents: \"none\",\n              boxShadow: \"0 0 4px rgba(0,0,0,0.5)\",\n              zIndex: 10\n            }}\n          >\n          </div>\n        ))}\n      </div>\n      \n      {/* Field Name Input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\", \n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Sample field name for saving clicks (as keypoints)\n          </span>\n          <input \n            type=\"text\"\n            value={fieldName}\n            onChange={(e) => setFieldName(e.target.value)}\n            placeholder=\"e.g., user_clicks, keypoints\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Keypoint Label Name Input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\", \n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Label name for the current set of clicks\n          </span>\n          <input \n            type=\"text\"\n            value={labelName}\n            onChange={(e) => setLabelName(e.target.value)}\n            placeholder=\"e.g., animal, person\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Keypoint Buttons */}\n      <div style={{ marginBottom: \"10px\", display: \"flex\", gap: \"10px\" }}>\n      <button \n          onClick={saveAsKeypoints}\n          disabled={clicks.length === 0}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: clicks.length > 0 ? \"#2196F3\" : \"#ccc\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: clicks.length > 0 ? \"pointer\" : \"not-allowed\",\n            fontWeight: \"bold\"\n          }}\n        >\n          Save as Keypoints ({clicks.length})\n        </button>\n        <button \n          onClick={clearClicks}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: \"#ff5555\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: \"pointer\"\n          }}\n        >\n          Clear Clicks ({clicks.length})\n        </button>\n      </div>\n\n      {/* Model Name Input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\", \n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Promptable segmentation model from FiftyOne model zoo\n          </span>\n          <input \n            type=\"text\"\n            value={modelName}\n            onChange={(e) => setModelName(e.target.value)}\n            placeholder=\"e.g., segment-anything-2-hiera-small-image-torch\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      <div style={{ marginBottom: \"10px\", display: \"flex\", gap: \"10px\" }}>\n      <button \n          onClick={segmentWithKeypoints}\n          disabled={clicks.length > 0}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: clicks.length > 0 ? \"#ccc\" : \"#2196F3\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: clicks.length == 0 ? \"pointer\" : \"not-allowed\",\n            fontWeight: \"bold\"\n          }}\n        >\n          Segment with keypoints\n        </button>\n      </div>\n    </div>\n\n    \n  );\n}","import { PluginComponentType, registerComponent } from \"@fiftyone/plugins\";\nimport { ClickSegmentation } from \"./ClickSegmentation\";\n\nregisterComponent({\n  name: \"ClickSegmentation\",\n  label: \"Click To Segment\",\n  component: ClickSegmentation,\n  type: PluginComponentType.Panel,\n  activator: myActivator,\n  panelOptions: {\n    surfaces: \"modal\",\n  },\n});\n\nfunction myActivator({ dataset }) {\n  return true;\n}\n"],"names":["ClickSegmentation","modalSample","useRecoilValue","fos","clicks","setClicks","useState","fieldName","setFieldName","modelName","setModelName","labelName","setLabelName","imageRef","useRef","containerRef","handleImageClick","event","img","container","imgRect","containerRect","x","y","imgX","imgY","displayWidth","displayHeight","normalizedX","normalizedY","clickData","prev","saveAsKeypoints","sampleId","keypointCoords","click","executeOperator","error","segmentWithKeypoints","clearClicks","sample","filepath","mediaUrl","index","registerComponent","PluginComponentType","myActivator","dataset"],"mappings":"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"}